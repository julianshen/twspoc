# Overview

A notification is a message generated by the system to capture a user's attention about something that needs action or awareness. Notifications may include metadata, attachments, and delivery details, and can be grouped for better user experience.

---

## Notification Object

```json
{
  "id": "string",               // Unique identifier
  "timestamp": "ISO8601",       // Time when event occurred
  "title": "string",            // Short summary
  "message": "string",          // Full message body
  "priority": "low | normal | high | critical",
  "read": true,                 // Read status

  "recipients": [               // Required: user or role targets
    {
      "type": "user | role | group",
      "id": "string"
    }
  ],

  "labels": ["string"],         // (Optional) Tags for filtering/categorization
  "attachments": [              // (Optional) Related object references
    {
      "type": "string",
      "id": "string",
      "url": "string"
    }
  ],
  "appName": "string",          // (Optional) App that sent the notification
  "appIcon": "string",          // (Optional) URL to app icon

  "expiry": "ISO8601",          // (Optional) Auto-expiry timestamp
  "actionButtons": [            // (Optional) Actions user can take
    {
      "label": "string",
      "action": "string",
      "url": "string"
    }
  ],
  "groupId": "string"           // (Optional) Identifier for grouped notifications
}

```

---

## Functional Requirements

- Notifications are immutable except for the `read` status.
- Optional fields (`labels`, `attachments`, `appName`, `appIcon`, `expiry`, `actionButtons`, `groupId`) enhance UX but are not required.
- Recipients define the users, roles, or groups that should receive the notification.
- Attachments should be resolvable references to system objects.
- Support filtering and sorting by timestamp, priority, labels, read status, and groupId.
- Notifications can be grouped for batch operations and UI clarity.

---

## Delivery and Presentation

- Channels: in-app, email, push notifications.
- User preferences: channel type and priority thresholds.
- UI: support inline action buttons and grouping by `groupId`.
- Expired notifications should be removed automatically.

---

## Auto-Grouping Logic

### Purpose

`groupId` allows grouping related notifications for better organization and interaction.

### Example Use Case

Three users approve the same document:

```json
{
  "groupId": "approval:doc-123",
  "title": "Approval Needed",
  "message": "Alice approved Document #123"
}

```

```json
{
  "groupId": "approval:doc-123",
  "title": "Approval Needed",
  "message": "Bob approved Document #123"
}

```

### Derivation Strategies

- **Code-based:**

```go
func deriveGroupId(n Notification) string {
  if n.Type == "approval" {
    return fmt.Sprintf("approval:%s", n.Metadata["documentId"])
  }
  return ""
}

```

- **Template-based config:**

```json
[
  {
    "match": { "type": "approval" },
    "groupIdTemplate": "approval:{{metadata.documentId}}"
  }
]

```

Frontend can collapse or group these by `groupId` for better presentation.

---

## Optional Enhancements

- `groupId` UI display: grouped lists or accordions.
- Rule engine for deriving groupId.
- Locale-aware notifications.
- Subscription preferences by app or tag.

---

## API Endpoints

### 1. Send Notification

**POST** `/api/notifications`

- Request body: Full notification object (excluding ID)
- Response: Created notification with ID

### 2. Mark Notification as Read

**POST** `/api/notifications/:id/read`

- Mark a single notification as read

### 3. Delete Notification

**DELETE** `/api/notifications/:id`

- Soft delete a notification for the current user

### 4. Subscribe to User's Notification Updates

**GET** `/api/notifications/subscribe`

- WebSocket or SSE stream of notification updates for the current user

### 5. Get Notification List

**GET** `/api/notifications?userId=xxx`

- Optional filters: `read`, `priority`, `labels`, `groupId`, `timestamp`

### 6. Search Notifications

**POST** `/api/notifications/search`

- Body: keyword, advanced filters (title, message, date range, labels, appName, etc.)
- Returns matched notifications

---
